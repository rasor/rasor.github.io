
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/font-awesome/css/solid.css">

    <link href="https://rasor.github.io/static/custom.css" rel="stylesheet">

    <link href="https://rasor.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Rasor's Tech Blog Atom">


    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">



<meta name="author" content="rasor" />
<meta name="description" content="This blog is part of a serie: Part 0.1: Install Docker Desktop on Windows 10 Home - including WSL Part 0.2: Install k8s using kind on Windows - including arkade Part 1.1: Run docker containers Part 1.2: Develop .NET docker images Part 1.3: Run containers in k8s …" />
<meta name="keywords" content="#csharp, #netcore3, #docker, #k8s, #jq, #vscode">


<meta property="og:site_name" content="Rasor's Tech Blog"/>
<meta property="og:title" content="ASP.NET Core with k8s hosting"/>
<meta property="og:description" content="This blog is part of a serie: Part 0.1: Install Docker Desktop on Windows 10 Home - including WSL Part 0.2: Install k8s using kind on Windows - including arkade Part 1.1: Run docker containers Part 1.2: Develop .NET docker images Part 1.3: Run containers in k8s …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://rasor.github.io/drafts/aspnet-core-with-k8s-hosting.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-10-27 00:00:00+01:00"/>
<meta property="article:modified_time" content="2020-11-09 10:30:00+01:00"/>
<meta property="article:author" content="https://rasor.github.io/author/rasor.html">
<meta property="article:section" content="Develop"/>
<meta property="article:tag" content="#csharp"/>
<meta property="article:tag" content="#netcore3"/>
<meta property="article:tag" content="#docker"/>
<meta property="article:tag" content="#k8s"/>
<meta property="article:tag" content="#jq"/>
<meta property="article:tag" content="#vscode"/>
<meta property="og:image" content="//s.gravatar.com/avatar/5b6cf6c4e0fa216452dccc8158bf673f?s=120">

  <title>Rasor's Tech Blog &ndash; ASP.NET Core with k8s hosting</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://rasor.github.io">
        <img src="//s.gravatar.com/avatar/5b6cf6c4e0fa216452dccc8158bf673f?s=120" alt="Rasor's Tech Blog" title="Rasor's Tech Blog">
      </a>
      <h1><a href="https://rasor.github.io">Rasor's Tech Blog</a></h1>

<p>... still playing with this Lego</p>
      <nav>
        <ul class="list">


            <li><a target="_blank" href="https://stackoverflow.com/users/750989/rasor" >StackOverflow</a></li>
            <li><a target="_blank" href="https://www.npmjs.com/~rasor" >npm</a></li>
            <li><a target="_blank" href="https://dock.io?r=sorenraarup:aaaaCSAu" >dock.io</a></li>
            <li><a target="_blank" href="https://keybase.io/rasor" >Keybase</a></li>
            <li><a target="_blank" href="https://stackoverflow.com/cv/rasor" >-- CV --</a></li>
            <li><a target="_blank" href="https://angel.co/rasor" >AngelList</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/rasor" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/rasor" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-wordpress" href="https://rasor.wordpress.com" target="_blank">
            <i class="fab fa-wordpress">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/rasor" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-bitbucket" href="https://bitbucket.org/rasor" target="_blank">
            <i class="fab fa-bitbucket">
            </i>
          </a></li>
          <li>
            <a  class="sc-rss" href="/feeds/all.atom.xml" target="_blank">
            <i class="fas fa-rss">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://rasor.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="/sitemap.xml">Sitemap</a>

      <a href="https://rasor.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="aspnet-core-with-k8s-hosting">ASP.NET Core with k8s hosting</h1>
    <p>
          Posted on October 27, 2020 in <a href="https://rasor.github.io/category/develop.html">Develop</a>

      </br>
        Updated: November 09, 2020
    </p>
  </header>


  <div>
    <p>This blog is part of a serie:</p>
<ul>
<li><a href="https://rasor.github.io/docker-desktop-for-windows-on-wsl2-part-01.html">Part 0.1: Install Docker Desktop on Windows 10 Home - including WSL</a></li>
<li><a href="https://rasor.github.io/k8s-on-windows-devbox-part-02.html">Part 0.2: Install k8s using kind on Windows - including arkade</a></li>
<li><a href="https://rasor.github.io/run-docker-containers-part-11.html">Part 1.1: Run docker containers</a></li>
<li><a href="https://rasor.github.io/develop-net-docker-images-part-12.html">Part 1.2: Develop .NET docker images</a></li>
<li>Part 1.3: Run containers in k8s (this blog)</li>
<li>Part 2: Deploy containers to Civo</li>
</ul>
<h1>Intro</h1>
<p>This blog is an example of a development cycle developing in C# on Windows using VSCode editor - also for debugging docker containers - and deploying to k8s.  </p>
<p>This blog is inspired by content from an eBook and some tutorials.<br>
You find its code in this git repo: <a href="https://github.com/rasor/eBook-UsingNETCoreDockerKubernetes">rasor/eBook-UsingNETCoreDockerKubernetes</a>.  </p>
<p>Main Sources are:
* Free eBook (2019): <a href="https://www.syncfusion.com/ebooks/using-netcore-docker-and-kubernetes-succinctly">Syncfusion Free Ebooks | Using .NET Core, Docker, and Kubernetes Succinctly</a>
  * By <a href="https://twitter.com/apomic80">@apomic80</a>      <br>
    * Github: <a href="https://github.com/apomic80">apomic80</a>
* Guide: <a href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/docker-apps-inner-loop-workflow">Inner-loop development workflow for Docker apps</a>
  * from free eBook (2020): <a href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/">Containerized Docker Application Lifecycle with Microsoft Platform and Tools</a> from Microsoft</p>
<h1>PreRequisites</h1>
<ul>
<li>Windows 10</li>
<li><a href="https://dotnet.microsoft.com/download">.NET Core 3.1 SDK</a></li>
<li><a href="https://gitforwindows.org/">Git Bash</a></li>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">C# for VSCode</a></li>
<li><a href="https://docs.docker.com/docker-for-windows/">Docker Desktop for Windows user manual</a></li>
<li><code>k8s</code> (I am using <code>kind</code> for <a href="K8sArkade.md">creating cluster</a>)</li>
<li>Optional: <a href="https://chocolatey.org/install">choco</a></li>
<li>Optional: <a href="https://stedolan.github.io/jq/download/">jq</a></li>
<li>Optional: <a href="https://helm.sh/">helm</a></li>
<li><code>choco install kubernetes-helm</code> or <code>arkade get helm</code></li>
<li>Optional: <a href="https://github.com/Azure/draft/blob/master/docs/quickstart.md">draft</a></li>
</ul>
<h1>Chapters from eBook <strong>Using .NET Core, Docker, and Kubernetes</strong></h1>
<h2>Chapter 1 ASP.NET and Docker Together</h2>
<h3>Chapter 1.1 Execute .NET Core application with Docker</h3>
<p>See <a href="https://rasor.github.io/run-docker-containers-part-11.html">Part 1.1: Run docker containers</a></p>
<h2>Chapter 2 Create Your Application with Docker</h2>
<h3>Chapter 2.1 Develop your ASP.NET Core application using Docker</h3>
<p>See <a href="https://rasor.github.io/develop-net-docker-images-part-12.html">Part 1.2: Develop .NET docker images</a></p>
<h2>Chapter 3 Deploy Your Application on Kubernetes</h2>
<h3>Chapter 3.2 Deploy your images in Kubernetes</h3>
<p>I am using <code>kind</code> for creating a <code>k8s</code> cluster. I did that in <a href="K8sArkade.md">this blog</a>.  </p>
<p>kubectl is a CLI using API to access k8s.  </p>
<div class="highlight"><pre><span></span><span class="c1"># check if k8s cluster is running</span>
kubectl cluster-info
<span class="c1"># Unable to connect to the server: dial tcp 127.0.0.1:52295: connectex: No connection could be made</span>

<span class="c1"># Check if there are any clusters</span>
$ kind get clusters
<span class="c1"># kind</span>

<span class="c1"># Check it the container is running</span>
docker ps -a <span class="p">|</span> grep kind
<span class="c1"># CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS                   PORTS                       NAMES</span>
<span class="c1"># 0b9a7220b4f8        kindest/node:v1.19.1   &quot;/usr/local/bin/entr…&quot;   5 weeks ago         Exited (0) 3 weeks ago   127.0.0.1:52295-&gt;6443/tcp   kind-control-plane</span>

<span class="c1"># start the k8s cluster</span>
docker start kind-control-plane

<span class="c1"># check if k8s cluster is running</span>
kubectl cluster-info
<span class="c1"># Kubernetes master is running at https://127.0.0.1:52295</span>
<span class="c1"># KubeDNS is running at https://127.0.0.1:52295/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
</pre></div>


<p>Testing starting the image in a pod manually:</p>
<div class="highlight"><pre><span></span><span class="c1"># Manually start the container in k8s - and never restart it, when it dies - let proxy know that pod should listen to :5000 and give container env-vars.  </span>
kubectl run frontend2 --image<span class="o">=</span>rasor/usingnetcoredockerkubernetes:frontend2-v1 --port<span class="o">=</span><span class="m">5000</span> --restart<span class="o">=</span>Never --env<span class="o">=</span><span class="s2">&quot;ASPNETCORE_URLS=http://+:5000&quot;</span>
<span class="c1"># pod/frontend2 created</span>

kubectl get pods
<span class="c1"># NAME        READY   STATUS    RESTARTS   AGE</span>
<span class="c1"># frontend2   1/1     Running   0          24s</span>

kubectl describe pod frontend2
<span class="c1"># Name:         frontend2</span>
<span class="c1"># Namespace:    default</span>
<span class="c1"># Priority:     0</span>
<span class="c1"># Node:         kind-control-plane/172.18.0.2</span>
<span class="c1"># Start Time:   Tue, 27 Oct 2020 12:24:42 +0100</span>
<span class="c1"># Labels:       run=frontend2</span>
<span class="c1"># Annotations:  &lt;none&gt;</span>
<span class="c1"># Status:       Running</span>
<span class="c1"># IP:           10.244.0.9</span>
<span class="c1"># IPs:</span>
<span class="c1">#   IP:  10.244.0.9</span>
<span class="c1"># Containers:</span>
<span class="c1">#   frontend2:</span>
<span class="c1">#     Container ID:   containerd://6134c6c308d49c4c49835009333ca5aaedf18d235712bec49a4ae4fbe9606c12</span>
<span class="c1">#     Image:          rasor/usingnetcoredockerkubernetes:frontend2-v1</span>
<span class="c1">#     Image ID:       docker.io/rasor/usingnetcoredockerkubernetes@sha256:e413934f1dba2e85b66f69125f6b4ac9944122c8f1c3d8f0f97355abb6ad8ec9       </span>
<span class="c1">#     Port:           5000/TCP</span>
<span class="c1">#     Host Port:      0/TCP</span>
<span class="c1">#     State:          Running</span>
<span class="c1">#       Started:      Tue, 27 Oct 2020 12:24:42 +0100</span>
<span class="c1">#     Ready:          True</span>
<span class="c1">#     Restart Count:  0</span>
<span class="c1">#     Environment:    &lt;none&gt;</span>
<span class="c1">#     Mounts:</span>
<span class="c1">#       /var/run/secrets/kubernetes.io/serviceaccount from default-token-95gtj (ro)</span>
<span class="c1"># Conditions:</span>
<span class="c1">#   Type              Status</span>
<span class="c1">#   Initialized       True</span>
<span class="c1">#   Ready             True</span>
<span class="c1">#   ContainersReady   True</span>
<span class="c1">#   PodScheduled      True</span>
<span class="c1"># Volumes:</span>
<span class="c1">#   default-token-95gtj:</span>
<span class="c1">#     Type:        Secret (a volume populated by a Secret)</span>
<span class="c1">#     SecretName:  default-token-95gtj</span>
<span class="c1">#     Optional:    false</span>
<span class="c1"># QoS Class:       BestEffort</span>
<span class="c1"># Node-Selectors:  &lt;none&gt;</span>
<span class="c1"># Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span>
<span class="c1">#                  node.kubernetes.io/unreachable:NoExecute for 300s</span>
<span class="c1"># Events:</span>
<span class="c1">#   Type    Reason     Age        From                         Message</span>
<span class="c1">#   ----    ------     ----       ----                         -------</span>
<span class="c1">#   Normal  Scheduled  &lt;unknown&gt;                               Successfully assigned default/frontend2 to kind-control-plane</span>
<span class="c1">#   Normal  Pulled     11s        kubelet, kind-control-plane  Container image &quot;rasor/usingnetcoredockerkubernetes:frontend2-v1&quot; already present </span>
<span class="c1"># on machine</span>
<span class="c1">#   Normal  Created    11s        kubelet, kind-control-plane  Created container frontend2</span>
<span class="c1">#   Normal  Started    11s        kubelet, kind-control-plane  Started container frontend2</span>

<span class="c1"># And what does that mean?</span>
kubectl explain pods

<span class="c1"># read all deployed in default namespace</span>
kubectl get all
<span class="c1"># NAME            READY   STATUS    RESTARTS   AGE</span>
<span class="c1"># pod/frontend2   1/1     Running   0          6m57s</span>

<span class="c1"># NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span>
<span class="c1"># service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   38d</span>
</pre></div>


<h4>API into k8s</h4>
<p>Start proxy in another terminal.<br>
This gives HTTP access to the k8s API on port 8001  </p>
<div class="highlight"><pre><span></span>kubectl proxy
</pre></div>


<p>Then open browser http://127.0.0.1:8001/</p>
<p>Try to reach pod via api:
http://127.0.0.1:8001/api/v1/namespaces/default/pods/frontend2/proxy/</p>
<p>Nice - the pod responds with a webpage :-)</p>
<div class="highlight"><pre><span></span><span class="c1"># print stdout from the container</span>
kubectl logs frontend2
<span class="c1">#       Storing keys in a directory &#39;/root/.aspnet/DataProtection-Keys&#39; that may not be persisted outside of the container. Protected data will be unavailable when container is destroyed.</span>
<span class="c1">#       No XML encryptor configured. Key {d848e8f7-df39-44b3-902c-b11019a1d9ab} may be persisted to storage in unencrypted form.</span>
<span class="c1">#       Now listening on: http://[::]:5000</span>
<span class="c1">#       Application started. Press Ctrl+C to shut down.</span>
<span class="c1">#       Hosting environment: Production</span>
<span class="c1">#       Content root path: /app</span>
<span class="c1">#       Failed to determine the https port for redirect.</span>
</pre></div>


<p>Stop the proxy with ctrl-c and instead use port forwarding:</p>
<div class="highlight"><pre><span></span><span class="c1"># Give localhost TCP access from port 5000 to the POD port 5000</span>
kubectl port-forward pod/frontend2 <span class="m">5000</span>:5000
<span class="c1"># Forwarding from 127.0.0.1:5000 -&gt; 5000</span>
<span class="c1"># Forwarding from [::1]:5000 -&gt; 5000</span>

<span class="c1"># browse to pod</span>
start http://localhost:5000
</pre></div>


<p><img alt="Web responds from pod" src="../img/2020/2020-10-27-K8s02.PNG">  </p>
<div class="highlight"><pre><span></span><span class="c1"># Delete the pod</span>
kubectl delete pod frontend2
<span class="c1"># pod &quot;frontend2&quot; deleted</span>
</pre></div>


<p>Tip:
* <a href="https://stackoverflow.com/a/51469150/750989">Port-forward also can forward to RS, SVC or Deployment</a>
* <a href="https://stackoverflow.com/a/62727416/750989">Port-forward also has --address to listen to</a>
* Port-forward tool for local dev: <a href="https://github.com/txn2/kubefwd">kubefwd</a></p>
<h4>UI into k8s</h4>
<p>To manage k8s you could use many different apps like
* <a href="https://marketplace.visualstudio.com/items?itemName=ms-kubernetes-tools.vscode-kubernetes-tools">Kubernetes VSCode plugin</a>
  * Double-click on a resource to see its yaml
  * View helm repos
  * View cloud clusters
* kubernetes-dashboard - just read - install via arkade or from remote yml file</p>
<div class="highlight"><pre><span></span><span class="c1"># install kubernetes-dashboard as a k8s app</span>
kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml
<span class="c1"># get login token</span>
kubectl -n kube-system get secret
kubectl -n kube-system describe secret deployment-controller-token-?????
kubectl proxy
<span class="c1"># paste login token into</span>
start http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login
</pre></div>


<ul>
<li>portainer - install via arkade</li>
<li><a href="https://rancher.com/quick-start/">Rancher</a></li>
<li><code>docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher</code></li>
<li><a href="https://www.kubernetic.com/">Kubernetic</a></li>
</ul>
<p><img alt="rancher" src="../img/2020/2020-10-27-K8s01.PNG"><br>
(<em>Image from Rancher</em>)</p>
<h4>Declare your infrastructure using yaml</h4>
<p>To define managed k8s infrastructure you write k8s yaml.<br>
Install <a href="https://marketplace.visualstudio.com/items?itemName=ipedrazas.kubernetes-snippets">Kubernetes Support</a> in VSCode.<br>
This will provide you with snippets for pods, services, deployments, etc.  </p>
<p>Now create a new file called <code>k8s-deploy-dev.yml</code>
* Write <code>kind: De</code> then 
* Press ctrl-space and select a Deployment template.   </p>
<p>With yml created you <code>create</code> or <code>apply</code> the file using <code>-f</code>.<br>
When you <code>apply</code> k8s will create-if-not-exist or change-if-not-correct.<br>
If you <code>create</code> you should <code>create --save-config</code>. Create will throw error, if resource exists.<br>
<a href="https://stackoverflow.com/a/54248723/750989">Read more...</a></p>
<p>These are the resources you can create (with the snippets):</p>
<div class="highlight"><pre><span></span>clusterrole         - Create a ClusterRole.
clusterrolebinding  - Create a ClusterRoleBinding for a particular ClusterRole
configmap           - Create a configmap from a local file, directory or literal value
cronjob             - Create a cronjob with the specified name.
deployment          - Create a deployment with the specified name.
job                 - Create a job with the specified name.
namespace           - Create a namespace with the specified name
poddisruptionbudget - Create a pod disruption budget with the specified name.
priorityclass       - Create a priorityclass with the specified name.
quota               - Create a quota with the specified name.
role                - Create a role with single rule.
rolebinding         - Create a RoleBinding for a particular Role or ClusterRole
secret              - Create a secret using specified subcommand
service             - Create a service using specified subcommand.
serviceaccount      - Create a service account with the specified name
</pre></div>


<p>Besides those above snippets you can find <code>C#</code> helm chart templates for
* <a href="https://github.com/Azure/draft/blob/master/packs/csharp/charts/templates/deployment.yaml">deployment</a>
* <a href="https://github.com/Azure/draft/blob/master/packs/csharp/charts/templates/ingress.yaml">ingress</a>
* <a href="https://github.com/Azure/draft/blob/master/packs/csharp/charts/templates/service.yaml">service</a>
... used by the k8s App builder tool <a href="https://github.com/Azure/draft/blob/master/docs/quickstart.md">Draft</a>.<br>
Note: draft is not yet upgraded to core 3.1, but is using core 2.1. The project is archieved!  </p>
<p>You can also just grap the whole yaml from this blog: <a href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/build-aspnet-core-applications-linux-containers-aks-kubernetes#deploy-webappyml">Build ASP.NET Core applications deployed as Linux containers into AKS/Kubernetes clusters</a><br>
and correct then names.  </p>
<p>You can print all resource types with<br>
<code>kubectl api-resources --sort-by=kind</code><br>
They are</p>
<div class="highlight"><pre><span></span>NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND
bindings                                                                      true         Binding
componentstatuses                 cs                                          false        ComponentStatus
configmaps                        cm                                          true         ConfigMap
endpoints                         ep                                          true         Endpoints
limitranges                       limits                                      true         LimitRange
namespaces                        ns                                          false        Namespace
nodes                             no                                          false        Node
persistentvolumes                 pv                                          false        PersistentVolume
persistentvolumeclaims            pvc                                         true         PersistentVolumeClaim
pods                              po                                          true         Pod
podtemplates                                                                  true         PodTemplate
replicationcontrollers            rc                                          true         ReplicationController
resourcequotas                    quota                                       true         ResourceQuota
secrets                                                                       true         Secret
services                          svc                                         true         Service
serviceaccounts                   sa                                          true         ServiceAccount

mutatingwebhookconfigurations                  admissionregistration.k8s.io   false        MutatingWebhookConfiguration
validatingwebhookconfigurations                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration
customresourcedefinitions         crd,crds     apiextensions.k8s.io           false        CustomResourceDefinition
apiservices                                    apiregistration.k8s.io         false        APIService
controllerrevisions                            apps                           true         ControllerRevision
daemonsets                        ds           apps                           true         DaemonSet
deployments                       deploy       apps                           true         Deployment
replicasets                       rs           apps                           true         ReplicaSet
statefulsets                      sts          apps                           true         StatefulSet
tokenreviews                                   authentication.k8s.io          false        TokenReview
selfsubjectaccessreviews                       authorization.k8s.io           false        SelfSubjectAccessReview
selfsubjectrulesreviews                        authorization.k8s.io           false        SelfSubjectRulesReview
subjectaccessreviews                           authorization.k8s.io           false        SubjectAccessReview
localsubjectaccessreviews                      authorization.k8s.io           true         LocalSubjectAccessReview
horizontalpodautoscalers          hpa          autoscaling                    true         HorizontalPodAutoscaler
cronjobs                          cj           batch                          true         CronJob
jobs                                           batch                          true         Job
certificatesigningrequests        csr          certificates.k8s.io            false        CertificateSigningRequest
leases                                         coordination.k8s.io            true         Lease
endpointslices                                 discovery.k8s.io               true         EndpointSlice
events                            ev           events.k8s.io                  true         Event
nodes                                          metrics.k8s.io                 false        NodeMetrics
pods                                           metrics.k8s.io                 true         PodMetrics
ingresses                         ing          networking.k8s.io              true         Ingress
ingressclasses                                 networking.k8s.io              false        IngressClass
networkpolicies                   netpol       networking.k8s.io              true         NetworkPolicy
runtimeclasses                                 node.k8s.io                    false        RuntimeClass
poddisruptionbudgets              pdb          policy                         true         PodDisruptionBudget
podsecuritypolicies               psp          policy                         false        PodSecurityPolicy
clusterroles                                   rbac.authorization.k8s.io      false        ClusterRole
clusterrolebindings                            rbac.authorization.k8s.io      false        ClusterRoleBinding
roles                                          rbac.authorization.k8s.io      true         Role
rolebindings                                   rbac.authorization.k8s.io      true         RoleBinding
priorityclasses                   pc           scheduling.k8s.io              false        PriorityClass
csidrivers                                     storage.k8s.io                 false        CSIDriver
csinodes                                       storage.k8s.io                 false        CSINode
storageclasses                    sc           storage.k8s.io                 false        StorageClass
volumeattachments                              storage.k8s.io                 false        VolumeAttachment
</pre></div>


<p>With the yaml in place you can now <code>create</code> or <code>apply</code> it:</p>
<div class="highlight"><pre><span></span><span class="c1"># deploy image to k8s</span>
kubectl create -f k8s-deploy-dev.yml
<span class="c1"># deployment.apps/frontend2 created</span>
<span class="c1"># service/frontend2 created</span>

<span class="c1"># print</span>
kubectl get services <span class="p">|</span> grep frontend2
<span class="c1"># NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span>
<span class="c1"># frontend2    LoadBalancer   10.106.254.38   &lt;pending&gt;     5000:30300/TCP   53s</span>

<span class="c1"># remove service</span>
kubectl delete service frontend2
<span class="c1"># service &quot;frontend2&quot; deleted</span>

<span class="c1"># remove replicaset, pod and deployment</span>
kubectl delete deployment frontend2
<span class="c1"># deployment.apps &quot;frontend2&quot; deleted</span>
</pre></div>


<div class="highlight"><pre><span></span>kubectl port-forward svc/frontend2 <span class="m">5000</span>:5000
<span class="c1"># Forwarding from 127.0.0.1:5000 -&gt; 5000</span>
<span class="c1"># Forwarding from [::1]:5000 -&gt; 5000</span>
<span class="c1"># Handling connection for 5000</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># stop the k8s cluster</span>
docker stop kind-control-plane
</pre></div>


<h1>REFs</h1>
<ul>
<li><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands">Kubectl Reference Docs</a></li>
<li>Using VSCode: <a href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/docker-apps-inner-loop-workflow">Inner-loop development workflow for Docker apps</a></li>
<li>Using Visual Studio: <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/docker-application-development-process/docker-app-development-workflow">Development workflow for Docker apps</a></li>
<li><a href="https://code.visualstudio.com/docs/containers/debug-common">Debug an app running in a Docker container</a></li>
<li>Debug using launch.json: <a href="https://github.com/OmniSharp/omnisharp-vscode/blob/master/debugger-launchjson.md">OmniSharp/omnisharp-vscode</a></li>
<li>tasks.json: <a href="https://code.visualstudio.com/docs/containers/quickstart-aspnet-core">Build and run an ASP.NET Core app in a container</a></li>
<li>tasks.json: <a href="https://code.visualstudio.com/docs/editor/tasks">Tasks in Visual Studio Code</a></li>
<li>Dockerfile: <a href="https://vsupalov.com/docker-build-time-env-values/">Setting Default Docker Environment Variables During Image Build</a></li>
<li>Change entry point: <a href="https://docs.microsoft.com/en-us/dotnet/core/docker/build-container?tabs=linux#change-the-entrypoint">Containerize an app with Docker tutorial - .NET Core</a></li>
<li>k8s: <a href="https://colinsalmcorner.com/devops-with-kubernetes-and-vsts-part-1/">DevOps with Kubernetes and VSTS: Part 1</a></li>
<li>AKS: <a href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/deploy-azure-kubernetes-service">Deploy to Azure Kubernetes Service (AKS)</a></li>
<li>Using VS - AKS: <a href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/build-aspnet-core-applications-linux-containers-aks-kubernetes">Build ASP.NET Core applications deployed as Linux containers into AKS/Kubernetes clusters</a></li>
<li>Program.cs <a href="https://wakeupandcode.com/generic-host-builder-in-asp-net-core-3-1/">Generic Host Builder in ASP .NET Core 3.1</a></li>
</ul>
<p>The End</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://rasor.github.io/tag/csharp.html">#csharp</a>
      <a href="https://rasor.github.io/tag/netcore3.html">#netcore3</a>
      <a href="https://rasor.github.io/tag/docker.html">#docker</a>
      <a href="https://rasor.github.io/tag/k8s.html">#k8s</a>
      <a href="https://rasor.github.io/tag/jq.html">#jq</a>
      <a href="https://rasor.github.io/tag/vscode.html">#vscode</a>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy; rasor 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Rasor's Tech Blog ",
  "url" : "https://rasor.github.io",
  "image": "//s.gravatar.com/avatar/5b6cf6c4e0fa216452dccc8158bf673f?s=120",
  "description": ""
}
</script>

</body>
</html>
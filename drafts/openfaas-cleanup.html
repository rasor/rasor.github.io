
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://rasor.github.io/theme/font-awesome/css/solid.css">

    <link href="https://rasor.github.io/static/custom.css" rel="stylesheet">

    <link href="https://rasor.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Rasor's Tech Blog Atom">


    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">



<meta name="author" content="rasor" />
<meta name="description" content="PreRequisites Docker OpenFaaS jq OpenFaaS Cleanup After having started OpenFaaS on Windows Devbox then Swarm will start new containers each time Docker On Windows (DoW) starts. This means you end up with a lot of containers which have been exited. So howto get rid of all the OpenFaaS exited images …" />
<meta name="keywords" content="#openfaas, #docker, #jq">


<meta property="og:site_name" content="Rasor's Tech Blog"/>
<meta property="og:title" content="OpenFaaS Cleanup"/>
<meta property="og:description" content="PreRequisites Docker OpenFaaS jq OpenFaaS Cleanup After having started OpenFaaS on Windows Devbox then Swarm will start new containers each time Docker On Windows (DoW) starts. This means you end up with a lot of containers which have been exited. So howto get rid of all the OpenFaaS exited images …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://rasor.github.io/drafts/openfaas-cleanup.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2099-01-01 00:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://rasor.github.io/author/rasor.html">
<meta property="article:section" content="Develop"/>
<meta property="article:tag" content="#openfaas"/>
<meta property="article:tag" content="#docker"/>
<meta property="article:tag" content="#jq"/>
<meta property="og:image" content="//s.gravatar.com/avatar/5b6cf6c4e0fa216452dccc8158bf673f?s=120">

  <title>Rasor's Tech Blog &ndash; OpenFaaS Cleanup</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://rasor.github.io">
        <img src="//s.gravatar.com/avatar/5b6cf6c4e0fa216452dccc8158bf673f?s=120" alt="Rasor's Tech Blog" title="Rasor's Tech Blog">
      </a>
      <h1><a href="https://rasor.github.io">Rasor's Tech Blog</a></h1>

<p>... still playing with this Lego</p>
      <nav>
        <ul class="list">


            <li><a target="_blank" href="https://stackoverflow.com/users/750989/rasor" >StackOverflow</a></li>
            <li><a target="_blank" href="https://www.npmjs.com/~rasor" >npm</a></li>
            <li><a target="_blank" href="https://dock.io?r=sorenraarup:aaaaCSAu" >dock.io</a></li>
            <li><a target="_blank" href="https://keybase.io/rasor" >Keybase</a></li>
            <li><a target="_blank" href="https://stackoverflow.com/cv/rasor" >-- CV --</a></li>
            <li><a target="_blank" href="https://angel.co/rasor" >AngelList</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/rasor" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/rasor" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-wordpress" href="https://rasor.wordpress.com" target="_blank">
            <i class="fab fa-wordpress">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/rasor" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-bitbucket" href="https://bitbucket.org/rasor" target="_blank">
            <i class="fab fa-bitbucket">
            </i>
          </a></li>
          <li>
            <a  class="sc-rss" href="/feeds/all.atom.xml" target="_blank">
            <i class="fas fa-rss">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://rasor.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="/sitemap.xml">Sitemap</a>

      <a href="https://rasor.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="openfaas-cleanup">OpenFaaS Cleanup</h1>
    <p>
          Posted on January 01, 2099 in <a href="https://rasor.github.io/category/develop.html">Develop</a>

      </br>
    </p>
  </header>


  <div>
    <h2>PreRequisites</h2>
<ul>
<li>Docker</li>
<li>OpenFaaS</li>
<li><a href="https://stedolan.github.io/jq/download/">jq</a></li>
</ul>
<h2>OpenFaaS Cleanup</h2>
<p>After having started <a href="https://rasor.github.io/openfaas-on-windows-devbox.html">OpenFaaS on Windows Devbox</a> then Swarm will start new containers each time Docker On Windows (DoW) starts.<br>
This means you end up with a lot of containers which have been exited.<br>
So howto get rid of all the OpenFaaS exited images?</p>
<div class="highlight"><pre><span></span><span class="c1"># Print images - tab delimted</span>
docker container ls --format<span class="o">=</span><span class="s2">&quot;{{ .Image}}\t{{ .Status}}&quot;</span>
<span class="c1"># openfaas/queue-worker:0.7.1     Up About an hour</span>
<span class="c1"># openfaas/gateway:0.11.1 Up About an hour</span>
<span class="c1"># nats-streaming:0.11.2   Up About an hour</span>
<span class="c1"># prom/alertmanager:v0.16.1       Up About an hour</span>
<span class="c1"># prom/prometheus:v2.7.1  Up About an hour</span>
<span class="c1"># openfaas/faas-swarm:0.6.1       Up About an hour</span>

<span class="c1"># longer command - table gives header and fixed witdh, jaon gives values in quotes</span>
docker container ls --format<span class="o">=</span><span class="s2">&quot;table {{json .Image}}\t{{json .Status}}&quot;</span>
<span class="c1"># IMAGE                           STATUS</span>
<span class="c1"># &quot;openfaas/queue-worker:0.7.1&quot;   &quot;Up About an hour&quot;</span>
<span class="c1"># &quot;openfaas/gateway:0.11.1&quot;       &quot;Up About an hour&quot;</span>
<span class="c1"># &quot;nats-streaming:0.11.2&quot;         &quot;Up About an hour&quot;</span>
<span class="c1"># &quot;prom/alertmanager:v0.16.1&quot;     &quot;Up About an hour&quot;</span>
<span class="c1"># &quot;prom/prometheus:v2.7.1&quot;        &quot;Up About an hour&quot;</span>
<span class="c1"># &quot;openfaas/faas-swarm:0.6.1&quot;     &quot;Up About an hour&quot;</span>

<span class="c1"># Convert all to json and select only some of the fields</span>
docker container ls --format <span class="s2">&quot; {{json .}}&quot;</span> <span class="p">|</span> jq <span class="s1">&#39;{ID, Image, Status}&#39;</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;ID&quot;: &quot;f56f6b94ab0f&quot;,</span>
<span class="c1">#   &quot;Image&quot;: &quot;prom/alertmanager:v0.16.1&quot;,</span>
<span class="c1">#   &quot;Status&quot;: &quot;Up 3 hours&quot;</span>
<span class="c1"># }</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;ID&quot;: &quot;b5a0f2cb0301&quot;,</span>
<span class="c1">#   &quot;Image&quot;: &quot;openfaas/queue-worker:0.7.1&quot;,</span>
<span class="c1">#   &quot;Status&quot;: &quot;Up 3 hours&quot;</span>
<span class="c1"># }</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;ID&quot;: &quot;7ec750aaa815&quot;,</span>
<span class="c1">#   &quot;Image&quot;: &quot;openfaas/faas-swarm:0.6.1&quot;,</span>
<span class="c1">#   &quot;Status&quot;: &quot;Up 3 hours&quot;</span>
<span class="c1"># }</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;ID&quot;: &quot;b58c1c59baad&quot;,</span>
<span class="c1">#   &quot;Image&quot;: &quot;prom/prometheus:v2.7.1&quot;,</span>
<span class="c1">#   &quot;Status&quot;: &quot;Up 3 hours&quot;</span>
<span class="c1"># }</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;ID&quot;: &quot;086e253e4e68&quot;,</span>
<span class="c1">#   &quot;Image&quot;: &quot;nats-streaming:0.11.2&quot;,</span>
<span class="c1">#   &quot;Status&quot;: &quot;Up 3 hours&quot;</span>
<span class="c1"># }</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;ID&quot;: &quot;a1a3381a45cf&quot;,</span>
<span class="c1">#   &quot;Image&quot;: &quot;openfaas/gateway:0.11.1&quot;,</span>
<span class="c1">#   &quot;Status&quot;: &quot;Up 3 hours&quot;</span>
<span class="c1"># }</span>

<span class="c1"># where status=exited and Networks=func_functions</span>
<span class="c1"># select ID, Image, Status</span>
docker container ls --filter <span class="s2">&quot;status=exited&quot;</span> --format <span class="s2">&quot; {{json .}}&quot;</span> <span class="p">|</span> jq <span class="s1">&#39;.&#39;</span> --slurp <span class="p">|</span> jq <span class="s1">&#39;.[] | select(.Networks == &quot;func_functions&quot;)&#39;</span> <span class="p">|</span> jq <span class="s1">&#39;{ID, Image, Status}&#39;</span>

<span class="c1"># Convert to JSON array</span>
<span class="c1"># where status=exited and Networks contains func_functions</span>
<span class="c1"># select json objs containing Networks</span>
<span class="c1"># pick valus of Networks</span>
docker container ls --filter <span class="s2">&quot;status=exited&quot;</span> --format <span class="s2">&quot; {{json .}}&quot;</span> <span class="p">|</span> jq <span class="s1">&#39;.&#39;</span> --slurp <span class="p">|</span> jq <span class="s1">&#39;.[] | select(.Networks | contains(&quot;func_functions&quot;))&#39;</span> <span class="p">|</span> jq <span class="s1">&#39;{Networks}&#39;</span>  <span class="p">|</span> jq <span class="s1">&#39;.Networks&#39;</span>

<span class="c1"># foreach object execute</span>
<span class="c1"># execute echo --someswitch &lt;network&gt; </span>
docker container ls --filter <span class="s2">&quot;status=exited&quot;</span> --format <span class="s2">&quot; {{json .}}&quot;</span> <span class="p">|</span> jq <span class="s1">&#39;.&#39;</span> --slurp <span class="p">|</span> jq <span class="s1">&#39;.[] | select(.Networks | contains(&quot;func_functions&quot;))&#39;</span> <span class="p">|</span> jq <span class="s1">&#39;.Networks&#39;</span> <span class="p">|</span> xargs -L1 <span class="nb">echo</span> <span class="s1">&#39;--someswitch&#39;</span>

<span class="c1"># remove exited containers - not working - why??</span>
docker container ls --filter <span class="s2">&quot;status=exited&quot;</span> --format <span class="s2">&quot; {{json .}}&quot;</span> <span class="p">|</span> jq <span class="s1">&#39;.&#39;</span> --slurp <span class="p">|</span> jq <span class="s1">&#39;.[] | select(.Networks | contains(&quot;func_functions&quot;))&#39;</span> <span class="p">|</span> jq -r <span class="s1">&#39;.ID&#39;</span> <span class="p">|</span> xargs -L1 docker container rm
<span class="c1"># Error: No such container: e4e419c18314</span>

<span class="c1"># without jq</span>
docker ps --filter <span class="s2">&quot;status=exited&quot;</span> <span class="p">|</span> grep <span class="s1">&#39;weeks ago&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> xargs --no-run-if-empty docker rm

<span class="c1"># Remove all stopped containers</span>
docker container prune

<span class="c1"># Remove orphaned volumes and stopped containers, images and networks</span>
docker system prune

<span class="c1"># what is left?</span>
docker ps -a
</pre></div>


<h1>Links</h1>
<ul>
<li><a href="https://stackoverflow.com/a/17237701/750989">How to remove old Docker containers</a></li>
<li><a href="https://medium.freecodecamp.org/how-i-filter-and-grep-docker-containers-images-and-volumes-and-how-you-can-too-a60e52bf7784">How I filter and grep Docker</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/ps/#filtering">docker ps - Filtering</a></li>
<li><a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_04_02.html">Examples using grep</a></li>
<li><a href="https://github.com/rasor/awesome-tables/blob/master/awesome-cli-on-windows.md#tools">Awesome CLI - on Windows - Tools</a></li>
<li><a href="https://stedolan.github.io/jq/manual/#TypesandValues">jq Manual</a></li>
<li><a href="https://stackoverflow.com/questions/43192556/using-jq-with-bash-to-run-command-for-each-object-in-array">Using jq with bash to run command for each object in array</a></li>
<li><a href="https://medium.freecodecamp.org/how-to-transform-json-to-csv-using-jq-in-the-command-line-4fa7939558bf">How to transform JSON to CSV using jq</a></li>
<li><a href="https://github.com/kislyuk/yq">kislyuk/yq - jq wrapper for YAML and XML documents</a></li>
</ul>
<p>The End</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://rasor.github.io/tag/openfaas.html">#openfaas</a>
      <a href="https://rasor.github.io/tag/docker.html">#docker</a>
      <a href="https://rasor.github.io/tag/jq.html">#jq</a>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy; rasor 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Rasor's Tech Blog ",
  "url" : "https://rasor.github.io",
  "image": "//s.gravatar.com/avatar/5b6cf6c4e0fa216452dccc8158bf673f?s=120",
  "description": ""
}
</script>

</body>
</html>